{% extends 'baseadmin.html' %}

{% block title %}Lista de Productos{% endblock %}

{% block body %}
<!--MENSAJE DE ALERTA SweetAlert2-->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class=flashes>
    {% for category, message in messages %}
    <script type="text/javascript">
        const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            }
        });
        Toast.fire({
            icon: "success",
            title: "{{message}}"
        });
    </script>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<script>
    function confirmarEliminacionProducto(url) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: "¡No podrás revertir esto!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = url;
            }
        });
    }
</script>

<div class="container p-5 mt-3">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-success">Lista de Productos</h1>
        <a href="{{ url_for('listar_productos_agregados') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Agregar Producto
        </a>
    </div>

    {% if productos %}
    <!-- Controles de búsqueda y mostrar registros -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="d-flex align-items-center">
                <label class="me-2">Mostrar</label>
                <select class="form-select form-select-sm" style="width: auto;">
                    <option>25</option>
                    <option>50</option>
                    <option>100</option>
                </select>
                <label class="ms-2">registros</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="d-flex justify-content-end">
                <label class="me-2">Buscar:</label>
                <input type="text" class="form-control form-control-sm" style="width: auto;" 
                       placeholder="Buscar en esta tabla...">
            </div>
        </div>
    </div>

    <!-- Tabla de productos -->
    <div class="table-responsive">
        <table class="table table-hover table-striped table-bordered">
            <thead class="table-success">
                <tr>
                    <th scope="col" class="text-center">ID</th>
                    <th scope="col" class="text-center">Nombre</th>
                    <th scope="col" class="text-center">Precio</th>
                    <th scope="col" class="text-center">Descripción</th>
                    <th scope="col" class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in productos %}
                <tr>
                    <td class="text-center">{{ producto.id }}</td>
                    <td>{{ producto.Nombre }}</td>
                    <td class="text-center">${{ producto.Precio }}</td>
                    <td>{{ producto.Descripcion }}</td>
                    <td class="text-center">
                        <!-- Botones de acciones -->
                        <div class="btn-group" role="group">
                            <!-- Botón Editar -->
                            <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" 
                                    data-bs-target="#modalEditProducto{{producto.id}}">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            <!-- Botón Eliminar -->
                            <button class="btn btn-outline-danger btn-sm" 
                                    onclick="confirmarEliminacionProducto('/borrar_producto/{{producto.id}}')">
                                <i class="bi bi-trash"></i> Eliminar
                            </button>
                        </div>
                    </td>
                </tr>

                <!-- Modal para Editar Producto -->
                <div class="modal fade" id="modalEditProducto{{producto.id}}" data-bs-backdrop="static" 
                     data-bs-keyboard="false" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header" style="background: linear-gradient(220deg, #ffffff,#7a9f7a,#355e3b);">
                                <h5 class="modal-title text-white">
                                    <i class="bi bi-pencil"></i> Editar Producto
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <form action="/editar_producto/{{producto.id}}" method="POST">
                                <div class="modal-body">
                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" name="nombre" 
                                               value="{{ producto.Nombre }}" required>
                                        <label>Nombre del Producto</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input type="number" step="0.01" class="form-control" name="precio" 
                                               value="{{ producto.Precio }}" required>
                                        <label>Precio</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" name="descripcion" 
                                                  style="height: 100px" required>{{ producto.Descripcion }}</textarea>
                                        <label>Descripción</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        Actualizar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Información de paginación -->
    <div class="row mt-3">
        <div class="col-md-6">
            <p class="text-muted">
                Mostrando 1 a {{ productos|length }} de {{ productos|length }} registros
            </p>
        </div>
        <div class="col-md-6">
            <!-- Aquí puedes agregar paginación si necesitas -->
        </div>
    </div>

    {% else %}
    <!-- Mensaje cuando no hay productos -->
    <div class="alert alert-info text-center py-4">
        <h4><i class="bi bi-info-circle"></i> No hay productos registrados</h4>
        <p class="mb-3">Comienza agregando tu primer producto al sistema</p>
        <a href="{{ url_for('listar_productos_agregados') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Agregar Primer Producto
        </a>
    </div>
    {% endif %}
</div>

<!-- Script para funcionalidad de búsqueda -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('input[type="text"]');
    const table = document.querySelector('table');
    const rows = table.querySelectorAll('tbody tr');
    
    searchInput.addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
});
</script>

<style>
    .table th {
        font-weight: 600;
        background-color: #d1e7dd !important;
    }
    
    .btn-group .btn {
        border-radius: 5px;
        margin: 0 2px;
    }
    
    .form-select-sm, .form-control-sm {
        width: auto !important;
        display: inline-block !important;
    }
</style>
{% endblock %}