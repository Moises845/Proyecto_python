{% extends 'baseadmin.html' %}

{% block title %}Lista de Usuarios{% endblock %}

{% block body %}
<!--MENSAJE DE ALERTA SweetAlert2-->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class=flashes>
    {% for category, message in messages %}
    <script type="text/javascript">
        const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            }
        });
        Toast.fire({
            icon: "success",
            title: "{{message}}"
        });
    </script>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<!--MENSAJE DE ALERTA PARA ELIMINACION SweetAlert2-->
<script>
    function confirmarEliminacion(url) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: "¡No podrás revertir esto!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = url;
            }
        });
    }
</script>

<div class="container p-5 mt-3">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-success">Lista de Usuarios</h1>
        <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#exampleModal">
            <i class="bi bi-person-plus"></i> Agregar Usuario
        </button>
    </div>

    {% if usuarios %}
    <!-- Tabla de Usuarios -->
    <div class="table-responsive">
        <table class="table table-hover table-striped table-bordered">
            <thead class="table-success">
                <tr>
                    <th scope="col" class="text-center">N°</th>
                    <th scope="col" class="text-center">Nombre</th>
                    <th scope="col" class="text-center">Correo</th>
                    <th scope="col" class="text-center">Password</th>
                    <th scope="col" class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for mostrar in usuarios %}
                <tr>
                    <td class="text-center">{{ mostrar.id }}</td>
                    <td>{{ mostrar.nombre }}</td>
                    <td>{{ mostrar.email }}</td>
                    <td class="text-center">{{ mostrar.password }}</td>
                    <td class="text-center">
                        <!-- Botones de acciones -->
                        <div class="btn-group" role="group">
                            <!-- Botón Editar -->
                            <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" 
                                    data-bs-target="#modaledit{{mostrar.id}}">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            <!-- Botón Eliminar -->
                            <button class="btn btn-outline-danger btn-sm" 
                                    onclick="confirmarEliminacion('/borrarUser/{{mostrar.id}}')">
                                <i class="bi bi-trash"></i> Eliminar
                            </button>
                        </div>
                    </td>
                </tr>

                <!-- MODAL editar usuario -->
                <div id="modaledit{{mostrar.id}}" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false"
                    role="dialog">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header"
                                style="background: linear-gradient(220deg, #ffffff,#7a9f7a,#355e3b);">
                                <h4 class="modal-title text-white">Actualizar información</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <!-- MODAL -->
                            <div class="modal-body">
                                <form action="{{url_for('updateUsuario')}}" method="POST">
                                    <div class="form-group mb-3">
                                        <label class="form-label">Nombre</label>
                                        <input type="hidden" name="id" value="{{mostrar.id}}">
                                        <input type="text" class="form-control" name="nombre"
                                            value="{{mostrar.nombre}}">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label class="form-label">Correo electrónico</label>
                                        <input type="email" class="form-control" name="email" value="{{mostrar.email}}">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label class="form-label">Password</label>
                                        <input type="text" class="form-control" name="password"
                                            value="{{mostrar.password}}">
                                    </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">Cancelar</button>
                                <button class="btn btn-primary" type="submit">Actualizar</button>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!---Fin de Editar Usuario Modal-->
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center">
        <h4>No hay usuarios registrados</h4>
    </div>
    {% endif %}
</div>

<!-- MODAL agregar un nuevo usuario -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="exampleModal" tabindex="-1" 
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(220deg, #ffffff,#7a9f7a,#355e3b);">
                <h1 class="modal-title fs-5 text-white" id="exampleModalLabel">Registro de Usuarios</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{{ url_for('guardar') }}" method="POST">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="nombre" id="name"
                            aria-describedby="helpId" placeholder="Nombre Completo" required />
                        <label for="nombre" class="form-label">Nombre Completo</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" name="email" id="email"
                            aria-describedby="helpId" placeholder="Correo Electronico" required />
                        <label for="email" class="form-label">Correo Electronico</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="password" id="password"
                            aria-describedby="helpId" placeholder="Contraseña" required />
                        <label for="password" class="form-label">Contraseña</label>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
            </form>
        </div>
    </div>
</div>

<style>
    .table th {
        font-weight: 600;
        background-color: #d1e7dd !important;
    }
    
    .btn-group .btn {
        border-radius: 5px;
        margin: 0 2px;
        font-size: 0.875rem;
    }
    
    .table td {
        vertical-align: middle;
    }
    
    .modal-header {
        border-bottom: 2px solid #355e3b;
    }
    
    .btn-outline-success {
        border-color: #355e3b;
        color: #355e3b;
    }
    
    .btn-outline-success:hover {
        background-color: #355e3b;
        color: white;
    }
</style>
{% endblock %}